---
created_at: 2024-07-04 18:54:44
---
记录一下 Obsidian 插件开发中的视图开发相关 API。通过官方教程[^1]起步，进一步熟悉 `View` 类[^2]的用法。

官方教程是以 `ItemView` [^3]作为示例的。

## 一个简单的 View 示例

````tab
tab: ExampleView.ts
```ts
import { ItemView, WorkspaceLeaf } from 'obsidian'

// 定义视图类型
export const ExampleView = 'example-view'

export class ExampleView extends ItemView {
	// 定义视图状态
	state: {
		// ...
	}

	constructor(leaf: WorkspaceLeaf) {
		super(leaf)
	}

	// 定义视图类型
	getViewType() {
		return ExampleView
	}

	// 定义图标
	// 图标名参考：https://lucide.dev/
	getIcon() {
		return 'aperture'
	}

	// 定义视图名称
	getDisplayText() {
		return '示例视图'
	}

	// 视图状态读取
	getState() {
		return this.state
	}

	// 视图状态更新
	setState(state: any) {
		this.state = state
		// 视图变更处理逻辑...
	}

	// 视图打开事件
	async onOpen() {
		const container = this.containerEl.children[1]
		container.empty()
		container.createEl("h4", { text: "Example view" });
	}
}
```
tab: ExamplePlugin.ts
```ts
import { Plugin, WorkspaceLeaf } from "obsidian";
import { ExampleView, VIEW_TYPE_EXAMPLE } from "./view";

export default class ExamplePlugin extends Plugin {
	async onload() {
		// 注册视图
		this.registerView(
			VIEW_TYPE_EXAMPLE,
			(leaf) => new ExampleView(leaf)
		)

		this.addRibbonIcon("dice", "Activate view", () => {
			this.activateView()
		})
	}

	async activateView() {
		const { workspace } = this.app

		let leaf: WorkspaceLeaf | null = null
		// 同一个视图类型可能会有多个实例
		const leaves = workspace.getLeavesOfType(VIEW_TYPE_EXAMPLE)

		if (leaves.length > 0) {
			// 取得第一个视图
			leaf = leaves[0]
		} else {
			// 也可以使用 workspace.getLeaf() // 传 '', true, 'split', 'tab', 'window' 来打开不同的 Leaf
			leaf = workspace.getRightLeaf(false)
			await leaf.setViewState({ type: VIEW_TYPE_EXAMPLE, active: true, state: {
				// 这里可以传入初始状态
			} })
		}

		// "Reveal" the leaf in case it is in a collapsed sidebar
		workspace.revealLeaf(leaf)
	}
}
```
````


## Workspace 的 Leaf 类型

```js
import { Plugin } from "obsidian";

export default class ExamplePlugin extends Plugin {
  async onload() {
    this.addRibbonIcon("dice", "Print leaf types", () => {
      this.app.workspace.iterateAllLeaves((leaf) => {
        console.log(leaf.getViewState().type);
      });
    });
  }
}
```

结果：

![[Pasted image 20240704150248.png]]

## 关于 Codemirror 6


有一些不错的参考：
- Obsidian CM6 Attributes Reference Plugin[^4]。
- Obsidian CM6 Zoom Reference Plugin[^5]
- Obsidian CM6 Syntax Highlighting[^6]
- Obsidian Editor Classes[^7]
- Atomic Ranges[^8]
- Obsidian Active Visual Line[^9]

### 文章参考

- [记录一下使用codemirror6写一个低代码脚本编辑器遇到的坑 - 掘金 (juejin.cn)](https://juejin.cn/post/7214686619097088059)
- [CodeMirror Decorations — Underline Example | by Evin Owen | Medium](https://evinowen.medium.com/codemirror-decorations-underline-example-dafd4ca4bda6)
- [CodeMirror Search. If you are interested in setting up… | by Evin Owen | Medium](https://evinowen.medium.com/codemirror-search-84bc73b1b1ee)
- [Easily track & remove content with decorations - v6 - discuss.CodeMirror](https://discuss.codemirror.net/t/easily-track-remove-content-with-decorations/4606)
- [Getting started with the new CodeMirror 6 | DataCamp Engineering](https://blog.datacamp.engineering/codemirror-6-getting-started-7fd08f467ed2)
- [CodeMirror 6+ vue3实现Atomic Ranges 功能 - 掘金 (juejin.cn)](https://juejin.cn/post/7268163789982777379)
- [How to build a Code Editor with CodeMirror 6 and TypeScript: Introduction (davidmyers.dev)](https://davidmyers.dev/blog/how-to-build-a-code-editor-with-codemirror-6-and-typescript/introduction)
- [Codemirror 6 highlighting specific substring - v6 - discuss.CodeMirror](https://discuss.codemirror.net/t/codemirror-6-highlighting-specific-substring/6615/4)



[^1]: [Views - Developer Documentation (obsidian.md)](https://docs.obsidian.md/Plugins/User+interface/Views)
[^2]: [View - Developer Documentation (obsidian.md)](https://docs.obsidian.md/Reference/TypeScript+API/View)
[^3]: [ItemView - Developer Documentation (obsidian.md)](https://docs.obsidian.md/Reference/TypeScript+API/ItemView)
[^4]: [nothingislost/obsidian-cm6-attributes (github.com)](https://github.com/nothingislost/obsidian-cm6-attributes)
[^5]: [nothingislost/obsidian-cm6-zoom (github.com)](https://github.com/nothingislost/obsidian-cm6-zoom)
[^6]: [nothingislost/obsidian-cm6-syntax-hightlighting: An experimental Obsidian plugin that syntax highlights custom code blocks (github.com)](https://github.com/nothingislost/obsidian-cm6-syntax-hightlighting)
[^7]: [nothingislost/obsidian-editor-classes: An experimental Obsidian plugin that adds frontmatter CSSClasses to the editor DOM (github.com)](https://github.com/nothingislost/obsidian-editor-classes)
[^8]: [nothingislost/obsidian-atomic-ranges: Adjust keyboard movement so that it skips over rendered block elements in the editor (github.com)](https://github.com/nothingislost/obsidian-atomic-ranges)
[^9]: [nothingislost/obsidian-active-visual-line: Add a line highlight to the active visual line (github.com)](https://github.com/nothingislost/obsidian-active-visual-line)