---
created_at: 2024-07-01 20:37:39
updated_at: 2024-07-02 11:58:17
---
获取当前编辑的文件信息：`app.workspace.getActiveFile()` 返回一个 TFile。

以 `文件名/路径/TFile.md` 为例，一个 TFile 包含以下信息：

- `basename` - 基本名称 `TFile`
- `extension` - 扩展名 `md`
- `name` - 文件名 `TFile.md`
- `parent` - 父级文件 TFile
- `path` 文件路径 `文件名/路径/TFile.md`
- `vault` 笔记仓库信息

使用 `app.fileManager`[^1] 管理文件：

1. `generateMarkdownLink(file, sourcePath, subpath, alias)` 基于用户的设置来生成 Markdown 链接。其中 `sourcePath` 传 `''`，传路径不起作用。`subpath` 可以为 `#标题` / `#^块ID`。

可以使用 `app.vault.getFileByPath("路径/文件名.md")` 和 `app.metadataCache.getFirstLinkpathDest("文件名", "")` 来获取 TFile 信息。

>[!tip] 注意：`getFirstLinkpathDest()` 第 2 个参数 `sourcePath` 同样传 `''`，别的参数不起作用。

2. `getAvailablePathForAttachment(filename: string, sourcePath?: string): Promise<string>` 解析要保存的附件文件的唯一路径。确保父目录存在，如果目标文件名已存在，则重复文件名。

示例：`await fileManager.getAvailablePathForAttachment('flowergrowth1.png')` 结果：`00 Meta/attachments/flowergrowth1.png`。

3. `getNewFileParent(sourcePath: string, newFilePath?: string): TFolder` 获取新文件应保存到的文件夹（基于用户的首选项设置）。

其中 TFolder 包含以下信息：`children` , `name`, `parent`, `path` 和 `vault`。

示例：`fileManager.getNewFileParent(workspace.getActiveFile()?.path || '').path` 结果 `文件名/路径`。

4. `processFrontMatter(file: TFile, fn: (frontmatter: any) => void, options?: DataWriteOptions): Promise<void>` 以原子方式读取、修改和保存笔记的卷首内容。frontmatter 作为 JS 对象传入，应直接进行变异以达到预期的结果。其中 `options` 为 `{ctime, mtime}`。

示例：

```js
await app.fileManager.processFrontMatter(workspace.getActiveFile(),(fm) => {
    fm.tags = "标签1,标签2"
})
```

5. `renameFile(file: TAbstractFile, newPath: string): Promise<void>` 安全地重命名或移动文件，并根据用户的首选项更新指向该文件的所有链接。

示例：

```js
const tFile = app.workspace.getActiveFile()
const tFileParentFolder = app.fileManager.getNewFileParent(tFile.path).path

await app.fileManager.renameFile(tFile, `${tFileParentFolder}/新名字.md`)
```
# 参考

[^1]: [FileManager - Developer Documentation (obsidian.md)](https://docs.obsidian.md/Reference/TypeScript+API/FileManager)