---
created_at: 2024-07-02 17:45:56
---
## 为插件添加扩展名和文件资源管理器上下文菜单

```js
import { normalizePath, Plugin } from 'obsidian';


export default class MyPlugin extends Plugin {
	async onload() {
		// 注册文件扩展名
		this.registerExtensions(['mdx'], "markdown")
		// 添加 ribbon 图标
		this.addRibbonIcon("add-note-glyph", "New .mdx file", (evt: MouseEvent) => this.createMDX())
		// 注册文件资源管理器右键菜单
		this.registerEvent(
			// 当用户打开上下文菜单并在文件资源管理器中选择了多个文件时触发。
			this.app.workspace.on("file-menu", (menu, file) => {
				menu.addItem((item) => {
					item.setTitle("New.mdx file")
						.setIcon("add-note-glyph")
						.onClick(async () => {
							let folder
							const fname = file.path
							if (fname.search("(\\.[^.]+)$") > 0 && file.parent) {
								folder = file.parent.path
							} else {
								folder = fname
							}
							this.createMDX(folder)
						})
				})
			})
		)
	}

	/**
	 * 创建新的.mdx文件
	 * @param folder 目录
	 */
	createMDX(folder?: string) {
		if (!folder) {
			folder = this.app.fileManager.getNewFileParent(this.app.workspace.getActiveFile()?.path || '', "mdx").path
		}

		let filename = normalizePath(`${folder}/Untitled.mdx`)

		if (!this.checkExists(filename)) {
			this.app.vault.create(filename, "")
		} else {
			let iter = 0
			while (true) {
				iter += 1
				filename = normalizePath(`${folder}/Untitled ${iter}.mdx`)
				if (!this.checkExists(filename)) {
					this.app.vault.create(filename, "")
					break
				}
			}
		}
	}

	/**
	 * 检查文件是否存在
	 * @param path 文件路径
	 * @returns 是否创建成功
	 */
	checkExists(path: string) {
		return this.app.vault.getAbstractFileByPath(path) && true
	}
}
```
